---
import Layout from "@/layouts/Layout.astro";
import { ResetPasswordForm } from "@/components/auth/ResetPasswordForm";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { isFeatureEnabled } from "@/features";

// Feature flag check - redirect if auth is disabled
if (!isFeatureEnabled("auth")) {
  return Astro.redirect("/");
}

// Odczyt tokena z URL
const token = Astro.url.searchParams.get("token");

// Walidacja tokena
const isValidToken = token && token.length > 0;
---

<Layout title="Resetowanie hasła - AdoptMe">
  <div class="min-h-screen flex items-center justify-center px-4 py-12">
    <div class="w-full max-w-md">
      {
        isValidToken ? (
          <ResetPasswordForm client:load token={token} />
        ) : (
          <Card>
            <CardHeader>
              <CardTitle>Nieprawidłowy link</CardTitle>
              <CardDescription>Link do resetowania hasła jest nieprawidłowy lub wygasł</CardDescription>
            </CardHeader>
            <CardContent class="space-y-4">
              <p class="text-sm text-muted-foreground">
                Aby zresetować hasło, wygeneruj nowy link z formularza odzyskiwania hasła.
              </p>
              <Button asChild class="w-full">
                <a href="/auth/forgot-password">Wygeneruj nowy link</a>
              </Button>
            </CardContent>
          </Card>
        )
      }
    </div>
  </div>
</Layout>
